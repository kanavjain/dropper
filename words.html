<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlayCanvas Speech Webtoy</title>
    <script src="https://code.playcanvas.com/playcanvas-stable.min.js"></script>
</head>
<body>

    <button id="start-button">Start Speech Input</button>
    <canvas id="application-canvas"></canvas>

    <script>
        const canvas = document.getElementById('application-canvas');
        const startButton = document.getElementById('start-button');
        const app = new pc.Application(canvas, {});

        // Set up PlayCanvas scene
        app.start();
        app.setCanvasFillMode(pc.FILLMODE_FILL_WINDOW);
        app.setCanvasResolution(pc.RESOLUTION_AUTO);

        const camera = new pc.Entity('camera');
        camera.addComponent('camera', {
            clearColor: new pc.Color(0.2, 0.2, 0.2)
        });
        camera.setPosition(0, 0, 10);
        app.root.addChild(camera);

        const light = new pc.Entity('light');
        light.addComponent('light');
        light.setEulerAngles(45, 30, 0);
        app.root.addChild(light);

        // Add text entity
        const textEntity = new pc.Entity();
        textEntity.addComponent('element', {
            type: pc.ELEMENTTYPE_TEXT,
            anchor: [0.5, 0.5, 0.5, 0.5],
            fontSize: 50,
            pivot: [0.5, 0.5],
            text: 'Waiting for speech...',
            color: new pc.Color(1, 1, 1)
        });
        app.root.addChild(textEntity);

        // Speech recognition setup
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;

        function updateText(newText) {
            textEntity.element.text = newText;
            textEntity.setLocalPosition(Math.random() * 2 - 1, Math.random() * 2 - 1, 0);  // Random position for visual effect
            textEntity.setLocalEulerAngles(0, 0, Math.random() * 360);  // Random rotation
        }

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            updateText(transcript);
        };

        startButton.addEventListener('click', () => {
            recognition.start();
        });

        app.on('update', function (dt) {
            // Rotate the text for visual effect
            textEntity.rotate(0, dt * 30, 0);
        });
    </script>

</body>
</html>
